import React, { useEffect, useState, useRef } from "react";
import Button from "../UI/CustomButton";
import classes from "./DataForm.module.css";
import { useDispatch, useSelector } from "react-redux";
import { saveMovie, updateMovie } from "../../store/api-call";
import { fetchDetail } from "../../store/api-call";
import { movieActions } from "../../store/data-slice";
import { useParams } from "react-router-dom";
import Card from "../UI/Card/Card";

const DataForm = () => {
  const movie = useSelector((state) => state.movies.selectedItem);
  const dispatch = useDispatch();
  const { id } = useParams();
  const [movieName, setMovieName] = useState("");
  const [imdbRating, setImdbRating] = useState("");
  const [imdbVotes, setImdbVots] = useState("");
  const [runtime, setRuntime] = useState("");
  const [year, setYear] = useState("");
  const [description, setDescription] = useState("");
  const [director, setDirector] = useState("");
  const [stars, setStars] = useState("");
  const [generes, setGeneres] = useState("");
  const [languages, setLanguages] = useState("");
  const [awards, setAwards] = useState("");
  const [poster, setPoster] = useState("");
  
  

  useEffect(() => {
    if (id !== undefined) {
      dispatch(fetchDetail(id, "movies", movieActions));
    }
    if(id===undefined){
      console.log('fuck');
    }
  }, [id]);

  const formSubmitHandler = (e) => {
    e.preventDefault();
    if (id === null) {
      dispatch(
        saveMovie(`http://localhost:8080/api/movies`, {
          movieName,
          imdbRating,
          imdbVotes,
          runtime,
          year,
          description,
          director,
          stars,
          generes,
          languages,
          awards,
          poster,
        })
      );
    }
    if (id !==  null) {
      console.log("this is update");
      dispatch(
        updateMovie(`http://localhost:8080/api/movies/${id}`, {
          id,
          movieName,
          imdbRating,
          imdbVotes,
          runtime,
          year,
          description,
          director,
          stars,
          generes,
          languages,
          awards,
          poster,
        })
      );
    }

    
    setMovieName("");
    setImdbRating("");
    setImdbVots("");
    setRuntime("");
    setYear("");
    setDescription("");
    setDirector("");
    setStars("");
    setGeneres("");
    setLanguages("");
    setAwards("");
    setPoster("");
  };

  return (
    <div>
      <form onSubmit={formSubmitHandler}>
        <Card className={classes["wrapper"]}>
          <div className={classes["data-form-input"]}>
            <label>Movie name</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '':movie.title}
              required
              onChange={(e) => setMovieName(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>IMDB rating</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.imdbRating}
              required
              onChange={(e) => setImdbRating(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>IMDB votes</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.imdbVotes}
              required
              onChange={(e) => setImdbVots(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Runtime</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.runtime}
              required
              onChange={(e) => setRuntime(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Year</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.year}
              required
              onChange={(e) => setYear(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Description</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.plot}
              required
              onChange={(e) => setDescription(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Director</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.director}
              required
              onChange={(e) => setDirector(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Stars</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.actors}
              required
              onChange={(e) => setStars(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Generes</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '': movie.genre}
              required
              onChange={(e) => setGeneres(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Languages</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '':movie.language}
              required
              onChange={(e) => setLanguages(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Awards</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '':movie.awards}
              required
              onChange={(e) => setAwards(e.target.value)}
            />
          </div>
          <div className={classes["data-form-input"]}>
            <label>Poster Url:</label>
            <input
              type="text"
              defaultValue={id ===undefined ? '':movie.poster}
              onChange={(e) => setPoster(e.target.value)}
            />
          </div>

          <Button type="submit">Submit</Button>
        </Card>
      </form>
    </div>
  );
};

export default DataForm;
